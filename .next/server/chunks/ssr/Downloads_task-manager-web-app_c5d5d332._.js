module.exports=[66858,(a,b,c)=>{"use strict";b.exports=a.r(46586).vendored["react-ssr"].ReactDOM},47485,(a,b,c)=>{"use strict";b.exports=a.r(46586).vendored["react-ssr"].ReactServerDOMTurbopackClient},64791,a=>{"use strict";var b=a.i(64973);let c=(...a)=>a.filter((a,b,c)=>!!a&&""!==a.trim()&&c.indexOf(a)===b).join(" ").trim();var d={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let e=(0,b.forwardRef)(({color:a="currentColor",size:e=24,strokeWidth:f=2,absoluteStrokeWidth:g,className:h="",children:i,iconNode:j,...k},l)=>(0,b.createElement)("svg",{ref:l,...d,width:e,height:e,stroke:a,strokeWidth:g?24*Number(f)/Number(e):f,className:c("lucide",h),...k},[...j.map(([a,c])=>(0,b.createElement)(a,c)),...Array.isArray(i)?i:[i]])),f=(a,d)=>{let f=(0,b.forwardRef)(({className:f,...g},h)=>(0,b.createElement)(e,{ref:h,iconNode:d,className:c(`lucide-${a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,f),...g}));return f.displayName=`${a}`,f};a.s(["default",()=>f],64791)},58041,a=>{"use strict";let b=(0,a.i(64791).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);a.s(["Loader2",()=>b],58041)},36028,a=>{"use strict";var b=a.i(34162),c=a.i(60042),d=a.i(9559),e=a.i(73610);let f=(0,d.cva)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function g({className:a,variant:d,asChild:g=!1,...h}){let i=g?c.Slot:"span";return(0,b.jsx)(i,{"data-slot":"badge",className:(0,e.cn)(f({variant:d}),a),...h})}a.s(["Badge",()=>g])},54216,a=>{"use strict";let b=(0,a.i(64791).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);a.s(["Plus",()=>b],54216)},35503,a=>{"use strict";let b=(0,a.i(64791).default)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);a.s(["Send",()=>b],35503)},14155,a=>{"use strict";var b=a.i(64973),c=a.i(60133),d=a.i(91494),e=a.i(37392),f=a.i(96457),g=a.i(35593);function h(){let a=(0,e.useQueryClient)(),{activeConversation:h,setActiveConversation:i}=(0,f.useChatStore)(),{user:j}=(0,f.useAuthStore)(),k=(0,b.useRef)(null),l=(0,c.useQuery)({queryKey:["conversations"],queryFn:async()=>{let{data:a}=await g.apiClient.get("/api/messages/conversations");return a},staleTime:3e4}),m=(0,c.useQuery)({queryKey:["messages",h],queryFn:async()=>{if(!h)return[];let{data:a}=await g.apiClient.get(`/api/messages/conversations/${h}`);return a},enabled:!!h,staleTime:1e4,refetchInterval:5e3}),n=(0,d.useMutation)({mutationFn:async a=>{let{data:b}=await g.apiClient.post("/api/messages",a);return b},onSuccess:b=>{a.setQueryData(["messages",h],a=>a?[...a,b]:[b]),a.invalidateQueries({queryKey:["conversations"]})}}),o=(0,d.useMutation)({mutationFn:async a=>(await g.apiClient.put(`/api/messages/${a}/read`),a),onSuccess:b=>{a.setQueryData(["messages",h],a=>a?.map(a=>a.id===b?{...a,is_read:!0}:a))}}),p=(0,b.useCallback)(async a=>{if(!h||!j)return!1;try{return await n.mutateAsync({receiver_id:h,content:a}),!0}catch{return!1}},[h,j,n]),q=(0,b.useCallback)(()=>{k.current&&clearTimeout(k.current),k.current=setTimeout(()=>{},2e3)},[]);return(0,b.useEffect)(()=>()=>{k.current&&clearTimeout(k.current)},[]),{conversations:l.data||[],messages:m.data||[],activeConversation:h,isLoadingConversations:l.isLoading,isLoadingMessages:m.isLoading,setActiveConversation:i,sendMessage:p,handleTyping:q,markAsRead:o.mutate,refetchConversations:l.refetch,refetchMessages:m.refetch,isSending:n.isPending}}a.s(["useChat",()=>h])},86962,a=>{"use strict";var b=a.i(34162),c=a.i(29255),d=a.i(64973),e=a.i(59848),f=a.i(80100),g=a.i(4809),h=a.i(15061),i=a.i(54216),j=a.i(7366),k=a.i(58041),l=a.i(66975),m=a.i(11180),n=a.i(86217),o=a.i(36028),p=a.i(14155),q=a.i(73610);function r(){let[a,c]=(0,d.useState)(""),{conversations:e,activeConversation:r,setActiveConversation:s,isLoadingConversations:t,refetchConversations:u}=(0,p.useChat)();(0,d.useEffect)(()=>{u()},[u]);let v=e.filter(b=>!a||b.other_user_username.toLowerCase().includes(a.toLowerCase()));return t?(0,b.jsx)("div",{className:"flex h-full items-center justify-center border-r border-border bg-card",children:(0,b.jsx)(k.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):(0,b.jsxs)("div",{className:"flex h-full flex-col border-r border-border bg-card",children:[(0,b.jsxs)("div",{className:"border-b border-border p-4",children:[(0,b.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-foreground",children:"Messages"}),(0,b.jsx)(m.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(i.Plus,{className:"h-4 w-4"})})]}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(h.Search,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),(0,b.jsx)(l.Input,{placeholder:"Search conversations...",value:a,onChange:a=>c(a.target.value),className:"pl-9"})]})]}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto",children:0===v.length?(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[(0,b.jsx)(j.MessageSquare,{className:"mb-4 h-12 w-12 text-muted-foreground"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a?"No conversations found":"No conversations yet"})]}):v.map((a,c)=>{let d=r===a.other_user_id;return(0,b.jsxs)(f.motion.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.05*c},onClick:()=>s(a.other_user_id),className:(0,q.cn)("flex cursor-pointer items-center gap-3 border-b border-border p-4 transition-colors hover:bg-accent",d&&"bg-accent"),children:[(0,b.jsx)("div",{className:"relative",children:(0,b.jsx)(n.Avatar,{className:"h-10 w-10",children:(0,b.jsx)(n.AvatarFallback,{children:a.other_user_username.charAt(0).toUpperCase()})})}),(0,b.jsxs)("div",{className:"flex-1 overflow-hidden",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"font-medium text-foreground",children:a.other_user_username}),a.last_message_time&&(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:(0,g.format)(new Date(a.last_message_time),"h:mm a")})]}),a.last_message&&(0,b.jsx)("p",{className:"truncate text-sm text-muted-foreground",children:a.last_message})]}),a.unread_count>0&&(0,b.jsx)(o.Badge,{className:"h-5 w-5 rounded-full p-0 text-xs flex items-center justify-center",children:a.unread_count})]},a.other_user_id)})})]})}var s=a.i(35503),t=a.i(96457);function u(){let[a,c]=(0,d.useState)(""),e=(0,d.useRef)(null),{conversations:h,messages:i,activeConversation:o,sendMessage:r,isLoadingMessages:u,isSending:v}=(0,p.useChat)(),{user:w}=(0,t.useAuthStore)(),x=h.find(a=>a.other_user_id===o);(0,d.useEffect)(()=>{e.current?.scrollIntoView({behavior:"smooth"})},[i]);let y=async()=>{a.trim()&&!v&&await r(a.trim())&&c("")};return o?(0,b.jsxs)("div",{className:"flex h-full flex-col bg-background",children:[(0,b.jsx)("div",{className:"flex items-center justify-between border-b border-border p-4",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(n.Avatar,{className:"h-10 w-10",children:(0,b.jsx)(n.AvatarFallback,{children:x?.other_user_username?.charAt(0).toUpperCase()||"?"})}),(0,b.jsx)("div",{children:(0,b.jsx)("h3",{className:"font-semibold text-foreground",children:x?.other_user_username||"Unknown User"})})]})}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:u?(0,b.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,b.jsx)(k.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):0===i.length?(0,b.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No messages yet. Start the conversation!"})}):(0,b.jsxs)("div",{className:"space-y-4",children:[i.map((a,c)=>{let d=a.sender_id===w?.id,e=!d&&(0===c||i[c-1].sender_id!==a.sender_id);return(0,b.jsxs)(f.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:(0,q.cn)("flex items-end gap-2",d&&"flex-row-reverse"),children:[e?(0,b.jsx)(n.Avatar,{className:"h-8 w-8",children:(0,b.jsx)(n.AvatarFallback,{children:x?.other_user_username?.charAt(0).toUpperCase()||"?"})}):(0,b.jsx)("div",{className:"w-8"}),(0,b.jsxs)("div",{className:(0,q.cn)("max-w-[70%] rounded-2xl px-4 py-2",d?"rounded-br-sm bg-primary text-primary-foreground":"rounded-bl-sm bg-muted text-foreground"),children:[(0,b.jsx)("p",{className:"text-sm",children:a.content}),(0,b.jsx)("p",{className:(0,q.cn)("mt-1 text-xs",d?"text-primary-foreground/70":"text-muted-foreground"),children:(0,g.format)(new Date(a.created_at),"h:mm a")})]})]},a.id)}),(0,b.jsx)("div",{ref:e})]})}),(0,b.jsx)("div",{className:"border-t border-border p-4",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(l.Input,{placeholder:"Type a message...",value:a,onChange:a=>c(a.target.value),onKeyDown:a=>"Enter"===a.key&&!a.shiftKey&&y(),className:"flex-1",disabled:v}),(0,b.jsx)(m.Button,{onClick:y,disabled:!a.trim()||v,children:v?(0,b.jsx)(k.Loader2,{className:"h-4 w-4 animate-spin"}):(0,b.jsx)(s.Send,{className:"h-4 w-4"})})]})})]}):(0,b.jsx)("div",{className:"flex h-full items-center justify-center bg-background",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-muted",children:(0,b.jsx)(j.MessageSquare,{className:"h-8 w-8 text-muted-foreground"})}),(0,b.jsx)("h3",{className:"text-lg font-semibold text-foreground",children:"Select a conversation"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Choose a chat to start messaging"})]})})}function v(){let{isAuthenticated:a}=(0,t.useAuthStore)(),f=(0,c.useRouter)();return((0,d.useEffect)(()=>{a||f.push("/login")},[a,f]),a)?(0,b.jsx)(e.AppLayout,{title:"Chat",children:(0,b.jsxs)("div",{className:"-m-6 flex h-[calc(100vh-64px)]",children:[(0,b.jsx)("div",{className:"w-80 shrink-0",children:(0,b.jsx)(r,{})}),(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsx)(u,{})})]})}):null}a.s(["default",()=>v],86962)}];

//# sourceMappingURL=Downloads_task-manager-web-app_c5d5d332._.js.map