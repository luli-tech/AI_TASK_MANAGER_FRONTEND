(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,13976,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"warnOnce",{enumerable:!0,get:function(){return a}});let a=e=>{}},78699,e=>{"use strict";var t=e.i(60436);let r=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim();var a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,t.forwardRef)(({color:e="currentColor",size:n=24,strokeWidth:s=2,absoluteStrokeWidth:i,className:o="",children:c,iconNode:u,...l},d)=>(0,t.createElement)("svg",{ref:d,...a,width:n,height:n,stroke:e,strokeWidth:i?24*Number(s)/Number(n):s,className:r("lucide",o),...l},[...u.map(([e,r])=>(0,t.createElement)(e,r)),...Array.isArray(c)?c:[c]])),s=(e,a)=>{let s=(0,t.forwardRef)(({className:s,...i},o)=>(0,t.createElement)(n,{ref:o,iconNode:a,className:r(`lucide-${e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,s),...i}));return s.displayName=`${e}`,s};e.s(["default",()=>s],78699)},28572,e=>{"use strict";let t=(0,e.i(78699).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],28572)},8131,e=>{"use strict";let t=(0,e.i(78699).default)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);e.s(["Send",()=>t],8131)},1376,e=>{"use strict";var t=e.i(60436),r=e.i(94491),a=e.i(25322),n=e.i(97468),s=e.i(73843),i=e.i(28245);function o(){let e=(0,n.useQueryClient)(),{activeConversation:o,setActiveConversation:c}=(0,s.useChatStore)(),{user:u}=(0,s.useAuthStore)(),l=(0,t.useRef)(null),d=(0,r.useQuery)({queryKey:["conversations"],queryFn:async()=>{let{data:e}=await i.apiClient.get("/api/messages/conversations");return e},staleTime:3e4}),m=(0,r.useQuery)({queryKey:["messages",o],queryFn:async()=>{if(!o)return[];let{data:e}=await i.apiClient.get(`/api/messages/conversations/${o}`);return e},enabled:!!o,staleTime:1e4,refetchInterval:5e3}),h=(0,a.useMutation)({mutationFn:async e=>{let{data:t}=await i.apiClient.post("/api/messages",e);return t},onSuccess:t=>{e.setQueryData(["messages",o],e=>e?[...e,t]:[t]),e.invalidateQueries({queryKey:["conversations"]})}}),f=(0,a.useMutation)({mutationFn:async e=>(await i.apiClient.put(`/api/messages/${e}/read`),e),onSuccess:t=>{e.setQueryData(["messages",o],e=>e?.map(e=>e.id===t?{...e,is_read:!0}:e))}}),g=(0,t.useCallback)(async e=>{if(!o||!u)return!1;try{return await h.mutateAsync({receiver_id:o,content:e}),!0}catch{return!1}},[o,u,h]),x=(0,t.useCallback)(()=>{l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{},2e3)},[]);return(0,t.useEffect)(()=>()=>{l.current&&clearTimeout(l.current)},[]),{conversations:d.data||[],messages:m.data||[],activeConversation:o,isLoadingConversations:d.isLoading,isLoadingMessages:m.isLoading,setActiveConversation:c,sendMessage:g,handleTyping:x,markAsRead:f.mutate,refetchConversations:d.refetch,refetchMessages:m.refetch,isSending:h.isPending}}e.s(["useChat",()=>o])},61575,e=>{"use strict";var t=e.i(70484),r=e.i(9304),a=e.i(6915),n=e.i(45513);let s=(0,a.cva)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function i({className:e,variant:a,asChild:i=!1,...o}){let c=i?r.Slot:"span";return(0,t.jsx)(c,{"data-slot":"badge",className:(0,n.cn)(s({variant:a}),e),...o})}e.s(["Badge",()=>i])},24331,77377,e=>{"use strict";var t=e.i(5410),r=e.i(61466),a=e.i(58741),n=e.i(11015),s=e.i(41216),i=e.i(61450);function o(e,t){let r=(0,i.toDate)(e,t?.in);return r.setHours(0,0,0,0),r}function c(e,t,r){let[i,c]=(0,n.normalizeDates)(r?.in,e,t),u=o(i),l=o(c);return Math.round((u-(0,a.getTimezoneOffsetInMilliseconds)(u)-(l-(0,a.getTimezoneOffsetInMilliseconds)(l)))/s.millisecondsInDay)}function u(e,t){let a=(0,r.getDefaultOptions)(),n=t?.weekStartsOn??t?.locale?.options?.weekStartsOn??a.weekStartsOn??a.locale?.options?.weekStartsOn??0,s=(0,i.toDate)(e,t?.in),o=s.getDay();return s.setDate(s.getDate()-(7*(o<n)+o-n)),s.setHours(0,0,0,0),s}function l(e,t){return u(e,{...t,weekStartsOn:1})}e.s(["differenceInCalendarDays",()=>c],77377);var d=e.i(25163);function m(e,t){let r=(0,i.toDate)(e,t?.in),a=r.getFullYear(),n=(0,d.constructFrom)(r,0);n.setFullYear(a+1,0,4),n.setHours(0,0,0,0);let s=l(n),o=(0,d.constructFrom)(r,0);o.setFullYear(a,0,4),o.setHours(0,0,0,0);let c=l(o);return r.getTime()>=s.getTime()?a+1:r.getTime()>=c.getTime()?a:a-1}function h(e,t){let a=(0,i.toDate)(e,t?.in),n=a.getFullYear(),s=(0,r.getDefaultOptions)(),o=t?.firstWeekContainsDate??t?.locale?.options?.firstWeekContainsDate??s.firstWeekContainsDate??s.locale?.options?.firstWeekContainsDate??1,c=(0,d.constructFrom)(t?.in||e,0);c.setFullYear(n+1,0,o),c.setHours(0,0,0,0);let l=u(c,t),m=(0,d.constructFrom)(t?.in||e,0);m.setFullYear(n,0,o),m.setHours(0,0,0,0);let h=u(m,t);return+a>=+l?n+1:+a>=+h?n:n-1}function f(e,t){let r=Math.abs(e).toString().padStart(t,"0");return(e<0?"-":"")+r}let g={y(e,t){let r=e.getFullYear(),a=r>0?r:1-r;return f("yy"===t?a%100:a,t.length)},M(e,t){let r=e.getMonth();return"M"===t?String(r+1):f(r+1,2)},d:(e,t)=>f(e.getDate(),t.length),a(e,t){let r=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];default:return"am"===r?"a.m.":"p.m."}},h:(e,t)=>f(e.getHours()%12||12,t.length),H:(e,t)=>f(e.getHours(),t.length),m:(e,t)=>f(e.getMinutes(),t.length),s:(e,t)=>f(e.getSeconds(),t.length),S(e,t){let r=t.length;return f(Math.trunc(e.getMilliseconds()*Math.pow(10,r-3)),t.length)}},x={G:function(e,t,r){let a=+(e.getFullYear()>0);switch(t){case"G":case"GG":case"GGG":return r.era(a,{width:"abbreviated"});case"GGGGG":return r.era(a,{width:"narrow"});default:return r.era(a,{width:"wide"})}},y:function(e,t,r){if("yo"===t){let t=e.getFullYear();return r.ordinalNumber(t>0?t:1-t,{unit:"year"})}return g.y(e,t)},Y:function(e,t,r,a){let n=h(e,a),s=n>0?n:1-n;return"YY"===t?f(s%100,2):"Yo"===t?r.ordinalNumber(s,{unit:"year"}):f(s,t.length)},R:function(e,t){return f(m(e),t.length)},u:function(e,t){return f(e.getFullYear(),t.length)},Q:function(e,t,r){let a=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(a);case"QQ":return f(a,2);case"Qo":return r.ordinalNumber(a,{unit:"quarter"});case"QQQ":return r.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(a,{width:"narrow",context:"formatting"});default:return r.quarter(a,{width:"wide",context:"formatting"})}},q:function(e,t,r){let a=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(a);case"qq":return f(a,2);case"qo":return r.ordinalNumber(a,{unit:"quarter"});case"qqq":return r.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(a,{width:"narrow",context:"standalone"});default:return r.quarter(a,{width:"wide",context:"standalone"})}},M:function(e,t,r){let a=e.getMonth();switch(t){case"M":case"MM":return g.M(e,t);case"Mo":return r.ordinalNumber(a+1,{unit:"month"});case"MMM":return r.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(a,{width:"narrow",context:"formatting"});default:return r.month(a,{width:"wide",context:"formatting"})}},L:function(e,t,r){let a=e.getMonth();switch(t){case"L":return String(a+1);case"LL":return f(a+1,2);case"Lo":return r.ordinalNumber(a+1,{unit:"month"});case"LLL":return r.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(a,{width:"narrow",context:"standalone"});default:return r.month(a,{width:"wide",context:"standalone"})}},w:function(e,t,a,n){let o,c,l,m,g,x=Math.round((u(o=(0,i.toDate)(e,n?.in),n)-(c=(0,r.getDefaultOptions)(),l=n?.firstWeekContainsDate??n?.locale?.options?.firstWeekContainsDate??c.firstWeekContainsDate??c.locale?.options?.firstWeekContainsDate??1,m=h(o,n),(g=(0,d.constructFrom)(n?.in||o,0)).setFullYear(m,0,l),g.setHours(0,0,0,0),u(g,n)))/s.millisecondsInWeek)+1;return"wo"===t?a.ordinalNumber(x,{unit:"week"}):f(x,t.length)},I:function(e,t,r){let a,n,o,c=Math.round((l(a=(0,i.toDate)(e,void 0))-(n=m(a,void 0),(o=(0,d.constructFrom)(a,0)).setFullYear(n,0,4),o.setHours(0,0,0,0),l(o)))/s.millisecondsInWeek)+1;return"Io"===t?r.ordinalNumber(c,{unit:"week"}):f(c,t.length)},d:function(e,t,r){return"do"===t?r.ordinalNumber(e.getDate(),{unit:"date"}):g.d(e,t)},D:function(e,t,r){let a,n,s=c(a=(0,i.toDate)(e,void 0),((n=(0,i.toDate)(a,void 0)).setFullYear(n.getFullYear(),0,1),n.setHours(0,0,0,0),n))+1;return"Do"===t?r.ordinalNumber(s,{unit:"dayOfYear"}):f(s,t.length)},E:function(e,t,r){let a=e.getDay();switch(t){case"E":case"EE":case"EEE":return r.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(a,{width:"short",context:"formatting"});default:return r.day(a,{width:"wide",context:"formatting"})}},e:function(e,t,r,a){let n=e.getDay(),s=(n-a.weekStartsOn+8)%7||7;switch(t){case"e":return String(s);case"ee":return f(s,2);case"eo":return r.ordinalNumber(s,{unit:"day"});case"eee":return r.day(n,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(n,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(n,{width:"short",context:"formatting"});default:return r.day(n,{width:"wide",context:"formatting"})}},c:function(e,t,r,a){let n=e.getDay(),s=(n-a.weekStartsOn+8)%7||7;switch(t){case"c":return String(s);case"cc":return f(s,t.length);case"co":return r.ordinalNumber(s,{unit:"day"});case"ccc":return r.day(n,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(n,{width:"narrow",context:"standalone"});case"cccccc":return r.day(n,{width:"short",context:"standalone"});default:return r.day(n,{width:"wide",context:"standalone"})}},i:function(e,t,r){let a=e.getDay(),n=0===a?7:a;switch(t){case"i":return String(n);case"ii":return f(n,t.length);case"io":return r.ordinalNumber(n,{unit:"day"});case"iii":return r.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(a,{width:"short",context:"formatting"});default:return r.day(a,{width:"wide",context:"formatting"})}},a:function(e,t,r){let a=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(a,{width:"narrow",context:"formatting"});default:return r.dayPeriod(a,{width:"wide",context:"formatting"})}},b:function(e,t,r){let a,n=e.getHours();switch(a=12===n?"noon":0===n?"midnight":n/12>=1?"pm":"am",t){case"b":case"bb":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(a,{width:"narrow",context:"formatting"});default:return r.dayPeriod(a,{width:"wide",context:"formatting"})}},B:function(e,t,r){let a,n=e.getHours();switch(a=n>=17?"evening":n>=12?"afternoon":n>=4?"morning":"night",t){case"B":case"BB":case"BBB":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(a,{width:"narrow",context:"formatting"});default:return r.dayPeriod(a,{width:"wide",context:"formatting"})}},h:function(e,t,r){if("ho"===t){let t=e.getHours()%12;return 0===t&&(t=12),r.ordinalNumber(t,{unit:"hour"})}return g.h(e,t)},H:function(e,t,r){return"Ho"===t?r.ordinalNumber(e.getHours(),{unit:"hour"}):g.H(e,t)},K:function(e,t,r){let a=e.getHours()%12;return"Ko"===t?r.ordinalNumber(a,{unit:"hour"}):f(a,t.length)},k:function(e,t,r){let a=e.getHours();return(0===a&&(a=24),"ko"===t)?r.ordinalNumber(a,{unit:"hour"}):f(a,t.length)},m:function(e,t,r){return"mo"===t?r.ordinalNumber(e.getMinutes(),{unit:"minute"}):g.m(e,t)},s:function(e,t,r){return"so"===t?r.ordinalNumber(e.getSeconds(),{unit:"second"}):g.s(e,t)},S:function(e,t){return g.S(e,t)},X:function(e,t,r){let a=e.getTimezoneOffset();if(0===a)return"Z";switch(t){case"X":return b(a);case"XXXX":case"XX":return p(a);default:return p(a,":")}},x:function(e,t,r){let a=e.getTimezoneOffset();switch(t){case"x":return b(a);case"xxxx":case"xx":return p(a);default:return p(a,":")}},O:function(e,t,r){let a=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+w(a,":");default:return"GMT"+p(a,":")}},z:function(e,t,r){let a=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+w(a,":");default:return"GMT"+p(a,":")}},t:function(e,t,r){return f(Math.trunc(e/1e3),t.length)},T:function(e,t,r){return f(+e,t.length)}};function w(e,t=""){let r=e>0?"-":"+",a=Math.abs(e),n=Math.trunc(a/60),s=a%60;return 0===s?r+String(n):r+String(n)+t+f(s,2)}function b(e,t){return e%60==0?(e>0?"-":"+")+f(Math.abs(e)/60,2):p(e,t)}function p(e,t=""){let r=Math.abs(e);return(e>0?"-":"+")+f(Math.trunc(r/60),2)+t+f(r%60,2)}let v=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});default:return t.date({width:"full"})}},y=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});default:return t.time({width:"full"})}},j={p:y,P:(e,t)=>{let r,a=e.match(/(P+)(p+)?/)||[],n=a[1],s=a[2];if(!s)return v(e,t);switch(n){case"P":r=t.dateTime({width:"short"});break;case"PP":r=t.dateTime({width:"medium"});break;case"PPP":r=t.dateTime({width:"long"});break;default:r=t.dateTime({width:"full"})}return r.replace("{{date}}",v(n,t)).replace("{{time}}",y(s,t))}},N=/^D+$/,k=/^Y+$/,M=["D","DD","YY","YYYY"],D=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,S=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,C=/^'([^]*?)'?$/,O=/''/g,T=/[a-zA-Z]/;function P(e,a,n){let s=(0,r.getDefaultOptions)(),o=n?.locale??s.locale??t.defaultLocale,c=n?.firstWeekContainsDate??n?.locale?.options?.firstWeekContainsDate??s.firstWeekContainsDate??s.locale?.options?.firstWeekContainsDate??1,u=n?.weekStartsOn??n?.locale?.options?.weekStartsOn??s.weekStartsOn??s.locale?.options?.weekStartsOn??0,l=(0,i.toDate)(e,n?.in);if(!(l instanceof Date||"object"==typeof l&&"[object Date]"===Object.prototype.toString.call(l))&&"number"!=typeof l||isNaN(+(0,i.toDate)(l)))throw RangeError("Invalid time value");let d=a.match(S).map(e=>{let t=e[0];return"p"===t||"P"===t?(0,j[t])(e,o.formatLong):e}).join("").match(D).map(e=>{if("''"===e)return{isToken:!1,value:"'"};let t=e[0];if("'"===t){var r;let t;return{isToken:!1,value:(t=(r=e).match(C))?t[1].replace(O,"'"):r}}if(x[t])return{isToken:!0,value:e};if(t.match(T))throw RangeError("Format string contains an unescaped latin alphabet character `"+t+"`");return{isToken:!1,value:e}});o.localize.preprocessor&&(d=o.localize.preprocessor(l,d));let m={firstWeekContainsDate:c,weekStartsOn:u,locale:o};return d.map(t=>{if(!t.isToken)return t.value;let r=t.value;return(!n?.useAdditionalWeekYearTokens&&k.test(r)||!n?.useAdditionalDayOfYearTokens&&N.test(r))&&function(e,t,r){var a,n,s;let i,o=(a=e,n=t,s=r,i="Y"===a[0]?"years":"days of the month",`Use \`${a.toLowerCase()}\` instead of \`${a}\` (in \`${n}\`) for formatting ${i} to the input \`${s}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`);if(console.warn(o),M.includes(e))throw RangeError(o)}(r,a,String(e)),(0,x[r[0]])(l,r,o.localize,m)}).join("")}e.s(["format",()=>P],24331)},10348,e=>{"use strict";let t=(0,e.i(78699).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],10348)},97500,e=>{"use strict";var t=e.i(70484),r=e.i(94239),a=e.i(60436),n=e.i(63412),s=e.i(48326),i=e.i(24331),o=e.i(38065),c=e.i(10348),u=e.i(67840),l=e.i(28572),d=e.i(65636),m=e.i(88755),h=e.i(48139),f=e.i(61575),g=e.i(1376),x=e.i(45513);function w(){let[e,r]=(0,a.useState)(""),{conversations:n,activeConversation:w,setActiveConversation:b,isLoadingConversations:p,refetchConversations:v}=(0,g.useChat)();(0,a.useEffect)(()=>{v()},[v]);let y=n.filter(t=>!e||t.other_user_username.toLowerCase().includes(e.toLowerCase()));return p?(0,t.jsx)("div",{className:"flex h-full items-center justify-center border-r border-border bg-card",children:(0,t.jsx)(l.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):(0,t.jsxs)("div",{className:"flex h-full flex-col border-r border-border bg-card",children:[(0,t.jsxs)("div",{className:"border-b border-border p-4",children:[(0,t.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-foreground",children:"Messages"}),(0,t.jsx)(m.Button,{variant:"ghost",size:"icon",children:(0,t.jsx)(c.Plus,{className:"h-4 w-4"})})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(o.Search,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),(0,t.jsx)(d.Input,{placeholder:"Search conversations...",value:e,onChange:e=>r(e.target.value),className:"pl-9"})]})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto",children:0===y.length?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[(0,t.jsx)(u.MessageSquare,{className:"mb-4 h-12 w-12 text-muted-foreground"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:e?"No conversations found":"No conversations yet"})]}):y.map((e,r)=>{let a=w===e.other_user_id;return(0,t.jsxs)(s.motion.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.05*r},onClick:()=>b(e.other_user_id),className:(0,x.cn)("flex cursor-pointer items-center gap-3 border-b border-border p-4 transition-colors hover:bg-accent",a&&"bg-accent"),children:[(0,t.jsx)("div",{className:"relative",children:(0,t.jsx)(h.Avatar,{className:"h-10 w-10",children:(0,t.jsx)(h.AvatarFallback,{children:e.other_user_username.charAt(0).toUpperCase()})})}),(0,t.jsxs)("div",{className:"flex-1 overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"font-medium text-foreground",children:e.other_user_username}),e.last_message_time&&(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:(0,i.format)(new Date(e.last_message_time),"h:mm a")})]}),e.last_message&&(0,t.jsx)("p",{className:"truncate text-sm text-muted-foreground",children:e.last_message})]}),e.unread_count>0&&(0,t.jsx)(f.Badge,{className:"h-5 w-5 rounded-full p-0 text-xs flex items-center justify-center",children:e.unread_count})]},e.other_user_id)})})]})}var b=e.i(8131),p=e.i(73843);function v(){let[e,r]=(0,a.useState)(""),n=(0,a.useRef)(null),{conversations:o,messages:c,activeConversation:f,sendMessage:w,isLoadingMessages:v,isSending:y}=(0,g.useChat)(),{user:j}=(0,p.useAuthStore)(),N=o.find(e=>e.other_user_id===f);(0,a.useEffect)(()=>{n.current?.scrollIntoView({behavior:"smooth"})},[c]);let k=async()=>{e.trim()&&!y&&await w(e.trim())&&r("")};return f?(0,t.jsxs)("div",{className:"flex h-full flex-col bg-background",children:[(0,t.jsx)("div",{className:"flex items-center justify-between border-b border-border p-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(h.Avatar,{className:"h-10 w-10",children:(0,t.jsx)(h.AvatarFallback,{children:N?.other_user_username?.charAt(0).toUpperCase()||"?"})}),(0,t.jsx)("div",{children:(0,t.jsx)("h3",{className:"font-semibold text-foreground",children:N?.other_user_username||"Unknown User"})})]})}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:v?(0,t.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,t.jsx)(l.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):0===c.length?(0,t.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"No messages yet. Start the conversation!"})}):(0,t.jsxs)("div",{className:"space-y-4",children:[c.map((e,r)=>{let a=e.sender_id===j?.id,n=!a&&(0===r||c[r-1].sender_id!==e.sender_id);return(0,t.jsxs)(s.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:(0,x.cn)("flex items-end gap-2",a&&"flex-row-reverse"),children:[n?(0,t.jsx)(h.Avatar,{className:"h-8 w-8",children:(0,t.jsx)(h.AvatarFallback,{children:N?.other_user_username?.charAt(0).toUpperCase()||"?"})}):(0,t.jsx)("div",{className:"w-8"}),(0,t.jsxs)("div",{className:(0,x.cn)("max-w-[70%] rounded-2xl px-4 py-2",a?"rounded-br-sm bg-primary text-primary-foreground":"rounded-bl-sm bg-muted text-foreground"),children:[(0,t.jsx)("p",{className:"text-sm",children:e.content}),(0,t.jsx)("p",{className:(0,x.cn)("mt-1 text-xs",a?"text-primary-foreground/70":"text-muted-foreground"),children:(0,i.format)(new Date(e.created_at),"h:mm a")})]})]},e.id)}),(0,t.jsx)("div",{ref:n})]})}),(0,t.jsx)("div",{className:"border-t border-border p-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(d.Input,{placeholder:"Type a message...",value:e,onChange:e=>r(e.target.value),onKeyDown:e=>"Enter"===e.key&&!e.shiftKey&&k(),className:"flex-1",disabled:y}),(0,t.jsx)(m.Button,{onClick:k,disabled:!e.trim()||y,children:y?(0,t.jsx)(l.Loader2,{className:"h-4 w-4 animate-spin"}):(0,t.jsx)(b.Send,{className:"h-4 w-4"})})]})})]}):(0,t.jsx)("div",{className:"flex h-full items-center justify-center bg-background",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-muted",children:(0,t.jsx)(u.MessageSquare,{className:"h-8 w-8 text-muted-foreground"})}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-foreground",children:"Select a conversation"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Choose a chat to start messaging"})]})})}function y(){let{isAuthenticated:e}=(0,p.useAuthStore)(),s=(0,r.useRouter)();return((0,a.useEffect)(()=>{e||s.push("/login")},[e,s]),e)?(0,t.jsx)(n.AppLayout,{title:"Chat",children:(0,t.jsxs)("div",{className:"-m-6 flex h-[calc(100vh-64px)]",children:[(0,t.jsx)("div",{className:"w-80 shrink-0",children:(0,t.jsx)(w,{})}),(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsx)(v,{})})]})}):null}e.s(["default",()=>y],97500)}]);